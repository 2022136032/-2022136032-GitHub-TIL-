import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:flutter_svg/flutter_svg.dart';
import 'package:karrot_app_clone/app_theme.dart';
import 'package:karrot_app_clone/widgets/app_font.dart';
import 'package:karrot_app_clone/controllers/login_controller.dart';

class LoginPage extends StatelessWidget {
  const LoginPage({super.key});

  @override
  Widget build(BuildContext context) {
    // 컨트롤러 인스턴스화
    final controller = Get.put(LoginController());
    
    // 당근마켓의 메인 컬러 (주황색)
    const karrotColor = Color(0xffED7738);

    return Scaffold(
      backgroundColor: AppTheme.darkBackgroundColor,
      appBar: AppBar(
        backgroundColor: AppTheme.darkBackgroundColor,
        elevation: 0,
        leading: IconButton(
          icon: const Icon(Icons.arrow_back_ios_new, color: Colors.white),
          onPressed: () => Get.back(),
        ),
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.symmetric(horizontal: 24.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            const SizedBox(height: 30),
            // 큰 제목
            const AppFont(
              '당근에 오신 것을 환영해요!',
              fontSize: 28,
              fontWeight: FontWeight.bold,
              color: Colors.white,
            ),
            const SizedBox(height: 40),

            // 1. 이메일 입력 필드
            TextField(
              controller: controller.emailController,
              keyboardType: TextInputType.emailAddress,
              style: const TextStyle(color: Colors.white),
              decoration: InputDecoration(
                labelText: '이메일 주소',
                labelStyle: TextStyle(color: Colors.grey.shade400),
                enabledBorder: UnderlineInputBorder(
                  borderSide: BorderSide(color: Colors.grey.shade700),
                ),
                focusedBorder: const UnderlineInputBorder(
                  borderSide: BorderSide(color: karrotColor),
                ),
                // 실시간 유효성 검사 피드백
                suffixIcon: Obx(() => controller.isEmailValid.value
                    ? const Icon(Icons.check_circle, color: karrotColor, size: 20)
                    : const Icon(Icons.email, color: Colors.grey, size: 20)),
              ),
            ),
            const SizedBox(height: 20),

            // 2. 비밀번호 입력 필드
            TextField(
              controller: controller.passwordController,
              obscureText: true, // 비밀번호 숨김
              style: const TextStyle(color: Colors.white),
              decoration: InputDecoration(
                labelText: '비밀번호',
                labelStyle: TextStyle(color: Colors.grey.shade400),
                enabledBorder: UnderlineInputBorder(
                  borderSide: BorderSide(color: Colors.grey.shade700),
                ),
                focusedBorder: const UnderlineInputBorder(
                  borderSide: BorderSide(color: karrotColor),
                ),
                // 실시간 유효성 검사 피드백
                suffixIcon: Obx(() => controller.isPasswordValid.value
                    ? const Icon(Icons.check_circle, color: karrotColor, size: 20)
                    : const Icon(Icons.lock, color: Colors.grey, size: 20)),
              ),
            ),
            const SizedBox(height: 40),

            // 3. 로그인 버튼
            Obx(() => SizedBox(
              width: double.infinity,
              height: 50,
              child: ElevatedButton(
                onPressed: controller.isLoginButtonEnabled.value 
                    ? controller.attemptLogin 
                    : null, // 버튼 비활성화
                style: ElevatedButton.styleFrom(
                  backgroundColor: karrotColor,
                  disabledBackgroundColor: karrotColor.withOpacity(0.5),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(8),
                  ),
                ),
                child: const AppFont(
                  '로그인',
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                  color: Colors.white,
                ),
              ),
            )),
            const SizedBox(height: 20),

            // 4. 아이디/비밀번호 찾기, 회원가입 링크
            Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                _buildTextLink('비밀번호 찾기', () {}),
                _buildDivider(),
                _buildTextLink('이메일로 회원가입', () {
                  // TODO: 회원가입 페이지로 이동
                }),
              ],
            ),
            const SizedBox(height: 50),

            // 5. 소셜 로그인 옵션 (구분선)
            Row(
              children: [
                Expanded(child: Divider(color: Colors.grey.shade700)),
                Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 16.0),
                  child: AppFont(
                    '간편하게 다른 방법으로 시작',
                    fontSize: 14,
                    color: Colors.grey.shade400,
                  ),
                ),
                Expanded(child: Divider(color: Colors.grey.shade700)),
              ],
            ),
            const SizedBox(height: 20),

            // 6. 소셜 로그인 버튼 리스트
            _buildSocialLoginButton(
              'Apple로 계속하기', 
              'assets/svg/social/apple.svg',
              () {},
              backgroundColor: Colors.white,
              textColor: Colors.black,
            ),
            const SizedBox(height: 12),
            _buildSocialLoginButton(
              'Google로 계속하기', 
              'assets/svg/social/google.svg',
              () {},
              backgroundColor: Colors.white,
              textColor: Colors.black,
            ),
             const SizedBox(height: 12),
            _buildSocialLoginButton(
              '카카오로 계속하기', 
              'assets/svg/social/kakao.svg',
              () {},
              backgroundColor: const Color(0xffFEE500), // 카카오 노란색
              textColor: Colors.black,
            ),
            const SizedBox(height: 50),
          ],
        ),
      ),
    );
  }
  
  // 텍스트 링크 위젯
  Widget _buildTextLink(String text, VoidCallback onTap) {
    return GestureDetector(
      onTap: onTap,
      child: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 8.0),
        child: AppFont(
          text,
          fontSize: 14,
          color: Colors.grey.shade400,
          decoration: TextDecoration.underline,
          decorationColor: Colors.grey.shade400,
        ),
      ),
    );
  }

  // 구분선 위젯
  Widget _buildDivider() {
    return Container(
      width: 1,
      height: 14,
      color: Colors.grey.shade700,
    );
  }

  // 소셜 로그인 버튼 위젯
  Widget _buildSocialLoginButton(
    String text, 
    String iconPath, 
    VoidCallback onTap, 
    {required Color backgroundColor, required Color textColor}
  ) {
    return SizedBox(
      width: double.infinity,
      height: 50,
      child: ElevatedButton(
        onPressed: onTap,
        style: ElevatedButton.styleFrom(
          backgroundColor: backgroundColor,
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(8),
            side: BorderSide(color: Colors.grey.shade700, width: 0.5)
          ),
          elevation: 0,
        ),
        child: Stack(
          alignment: Alignment.center,
          children: [
            Align(
              alignment: Alignment.centerLeft,
              child: SvgPicture.asset(
                iconPath,
                width: 20,
                height: 20,
              ),
            ),
            AppFont(
              text,
              fontSize: 16,
              fontWeight: FontWeight.w500,
              color: textColor,
            ),
          ],
        ),
      ),
    );
  }
}
